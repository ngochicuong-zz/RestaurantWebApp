function OrderPage() {
	this.name = "order-page";
	this.seat;
	this.pageContainer = this.table = Dom.newDOMElement({
		_name : "hbox",
		id : "pageContainer",
		flex: "1"
	});
	
	var thiz = this;
	var callback = function(htmlText) {
		thiz.pageContainer.innerHTML = htmlText;
		thiz.init();
	}
	serverReport.getHTML("/getOrderPage.do", "GET", callback);
	
	
	
}

OrderPage.prototype.init = function() {
	this.seatImage = this.pageContainer.querySelector("#seat-Image");
	this.seatId = this.pageContainer.querySelector("#seatIdText");
	this.floor = this.pageContainer.querySelector("#floorText");
	this.room = this.pageContainer.querySelector("#roomText");
	this.capacity = this.pageContainer.querySelector("#seatCapacity");
	
	this.orderId = this.pageContainer.querySelector("#orderId");
	this.orderDate = this.pageContainer.querySelector("#orderDate");
	
	this.orderDetailTable = this.pageContainer.querySelector("#orderDetailTable");
	this.productNameIn = this.pageContainer.querySelector("#productText");
	this.qualityIn = this.pageContainer.querySelector("#quality");
	this.addOrderDetailBtn = this.pageContainer.querySelector("#addOrderDetail");
	
	
	this.backButton = this.pageContainer.querySelector("#back-button");
	console.log(this.backButton);
	this.backButton.addEventListener("click", function(ev){
		Main.pageManagement.active("table-page");
	});
	
	var theader = new Array("productName", "quality", "price", "total", "note");
	this.detailTable = new Table();
	this.detailTable.init(theader);
	this.orderDetailTable.appendChild(this.detailTable.getTable());
	
	this.comboPopup = new ComboPopup();
	this.comboPopup.renderHandler = function(popupContainer, items){
		popupContainer.innerHTML = "";
		for(var i = 0; i < items.length; i++) {
			var item = items[i];
			var container =  Dom.newDOMElement({
				_name : "hbox",
				flex:"1",
				_children: [
					{
						_name : "hbox",
						_text : item["productName"],
						flex:"1"
					
					},
					{
						_name : "hbox",
						_text : item["price"] + " vnd",
						style: "width: 5em; text-align: right"
					},
					{
						_name : "hbox",
						_text : item["unitType"]
					}
				]
			});
			container.data = item;
			popupContainer.appendChild(container);
		}
	};
	
	
	var thiz = this;
	this.productNameIn.addEventListener("change", function(e) {
		var value = thiz.productNameIn.value;
		var callback = function(products) {
			if (products == null) return;
			console.log(products);
			thiz.comboPopup.renderItems(products);
			thiz.comboPopup.toggleMenuOn(e.target);
		}
		serverReport.getJson("/searchProduct.do?name="+ value +"", "GET", callback);
	})
}

OrderPage.prototype.renewPage = function(){
	this.seat = null;
	this.detailTable.tableBody.innerHTML = "";
	this.seatId.innerHTML = "";
	this.floor.innerHTML = "";
	this.room.innerHTML = "";
	this.capacity.innerHTML = "";
	this.orderId.innerHTML = "";
	this.orderDate.innerHTML = "";
}

OrderPage.prototype.renderWithSeat = function(seat) {
	this.renewPage();
	this.seat = seat;
	this.seatId.innerHTML = this.seat.id;
	this.floor.innerHTML = this.seat.floor;
	this.room.innerHTML = this.seat.room;
	this.capacity.innerHTML = this.seat.capacity;
	this.renderOrder(seat);
}

OrderPage.prototype.renderOrder = function(seat){
	var thiz = this;
	var callback = function(order){
		console.log(order.id);
		if (order.id == null) return;
		thiz.orderId.innerHTML = order.id;
		thiz.orderDate.innerHTML = order.dataInsert;
		thiz.renderOrderDetail(order);
	}
	serverReport.getJson("/getOrderWithSeat.do?seatId="+ seat.id +"", "GET", callback);
}

OrderPage.prototype.renderOrderDetail = function(order) {
	if (order == null) return;
	var thiz = this;
	var callback = function(orderDetails){
		thiz.detailTable.render(orderDetails);
	}
	serverReport.getJson("/getOrderDetailWithOrder.do?orderId="+ order.id +"", "GET", callback);
}

OrderPage.prototype.getPageContainer = function() {
	return this.pageContainer;
}


